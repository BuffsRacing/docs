<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>FFMPEG Configurations - CUBRT</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/bootstrap-theme.min.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.3/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap.min.js"></script>
        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../..">CUBRT</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="../..">CU Boulder Racing Team</a>
                </li>
            
            
            
                <li >
                    <a href="../../visualisation/">Visualisation</a>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Telemtry and streaming <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../">Telemetry and Streaming</a>
                        </li>
                    
                        <li class="active">
                            <a href="./">FFMPEG Configurations</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                    <li >
                        <a rel="next" href="../">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li class="disabled">
                        <a rel="prev" >
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                <li>
                    <a href="https://github.com/CUBRT/docs/">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="row">
                    <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
      
    
        <li class="main active"><a href="#ffmpeg-configurations">FFMPEG Configurations</a></li>
        
            <li><a href="#react-native">React Native</a></li>
        
            <li><a href="#linux">Linux</a></li>
        
    
    
    </ul>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="ffmpeg-configurations">FFMPEG Configurations</h1>
<h2 id="react-native">React Native</h2>
<p>To test if FFMPEG is correctly installed, you can use this command to perform a test stream.</p>
<p><code>ffmpeg -v verbose -t 05:00 -f lavfi -i testsrc -f lavfi -i testsrc -f lavfi -i testsrc -f lavfi -i testsrc -ar 44100 -r 30 -g 60 -keyint_min 60 -b:v 400000 -c:v libx264 -preset medium -bufsize 400k -maxrate 400k -f flv rtmp://YOUR_RTMP_URL</code></p>
<p>Equivalent React Native Code:</p>
<pre><code class="language-javascript">import { FFmpegKit,ReturnCode } from 'ffmpeg-kit-react-native';

FFmpegKit.execute(`-v verbose -t 05:00 -f lavfi -i testsrc -f lavfi -i testsrc -f lavfi -i testsrc -f lavfi -i testsrc -ar 44100 -r 30 -g 60 -keyint_min 60 -b:v 400000 -c:v libx264 -preset medium -bufsize 400k -maxrate 400k -f flv &quot;${rtmpURL}&quot;`).then(async (session) =&gt; {
    const returnCode = await session.getReturnCode();

    if (ReturnCode.isSuccess(returnCode)) {

      // SUCCESS

    } else if (ReturnCode.isCancel(returnCode)) {

      // CANCEL

    } else {

      // ERROR

    }
  });
</code></pre>
<p>An iPhone 12, is able to stream <code>1280x720</code> normally on a stable WiFi connection, whereas a Google Pixel 3 streaming <code>640x480</code> is still a bit choppy. This could probably be improved by tweaking the ffmpeg command.</p>
<h3 id="android">Android</h3>
<p>The input device on Android is called <code>android_camera</code>. Sadly, FFMPEG on Android cannot use the microphone. Thus, if trying to set the RTMP URL to YouTube, <code>-i anullsrc</code> flag needs to be passed to add a silent audio. Otherwise, streaming to YouTube will silently fail.</p>
<p><code>ffmpeg -f android_camera -video_size 640x480 -i discarded -r 30 -c:v libx264 -f flv "YOUR_RTMP_URL"</code></p>
<p>The hardcoded resolution of <code>640x480</code> will be moved to a configurable option in the app.</p>
<h3 id="ios">iOS</h3>
<p>The input device on iOS is called <code>avfoundation</code>. </p>
<p><code>ffmpeg -f avfoundation -r 30 -video_size 1280x720 -pixel_format bgr0 -i 0:0 -vcodec h264_videotoolbox -vsync 2 -f flv "YOUR_RTMP_URL"</code></p>
<p>The hardcoded resolution of <code>1280x720</code> will be moved to a configurable option in the app.</p>
<h2 id="linux">Linux</h2>
<p>As of writing the script, Raspberry Pi OS (64 bit) was still in beta, and <code>video4linux</code> was not working properly in our testing. Thus, we tested this command on Raspbian OS, and are in the process of updating the Pi to RPi OS and updating the command.</p>
<p><code>ffmpeg -f v4l2 -framerate 25 -video_size 640x480 -i /dev/video0 -c:v libx264 -b:v 700k -maxrate 700k -bufsize 700k -an -f flv rtmp://YOUR_RTMP_URL</code></p></div>
                </div>
        </div>

    <hr>
    <footer class="container">
        
        <center>Documentation built with <a href="http://www.mkdocs.org">MkDocs</a> and <a href="http://kristopolous.github.io/BOOTSTRA.386">BOOTSTRA.386</a>.</center>
    </footer>
        <script src="../../search/main.js"></script>
    </body>
</html>